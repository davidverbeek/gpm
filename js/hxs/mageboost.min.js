function _getIeVer(){var e=-1;if(navigator.appName=="Microsoft Internet Explorer"){var t=navigator.userAgent,n=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");n.exec(t)!=null&&(e=parseFloat(RegExp.$1))}return e}function _browserSupportsLocalStorage(){if(typeof _browserSupportsLocalStorageSet!="undefined"&&_browserSupportsLocalStorageSet!=null)return _browserSupportsLocalStorageSet;try{return localStorage.setItem("mblc_storagetest","test"),localStorage.removeItem("mblc_storagetest"),_contextDebugLog("browser supports writing to localStorage..."),_browserSupportsLocalStorageSet=!0,!0}catch(e){return _contextDebugLog("browser does NOT support writing to localStorage..."),_browserSupportsLocalStorageSet=!1,!1}}function _browserSupportsSessionStorage(){if(_browserSupportsSessionStorageSet!=null)return _browserSupportsSessionStorageSet;try{return sessionStorage.setItem("mblc_storagetest","test"),sessionStorage.removeItem("mblc_storagetest"),_contextDebugLog("browser supports writing to sessionStorage..."),_browserSupportsSessionStorageSet=!0,!0}catch(e){return _contextDebugLog("browser does NOT support writing to sessionStorage..."),_browserSupportsSessionStorageSet=!1,!1}}function _browserSupportsCookieStorage(){if(_browserSupportsCookieStorageSet!=null)return _browserSupportsCookieStorageSet;try{_setCookie("mblc_storagetest","test",3600);var e=_getCookie("mblc_storagetest");return e=="test"?(_contextDebugLog("browser supports writing to cookieStorage..."),_browserSupportsCookieStorageSet=!0,_removeCookie("mblc_storagetest"),!0):!1}catch(t){return _contextDebugLog("browser does NOT support writing to cookieStorage..."),_browserSupportsCookieStorageSet=!1,!1}}function _contextDebugLog(e){if(typeof _contextShowDebug!="undefined")if(_contextShowDebug==1||_getCookie("mb.dbg")==1){var t=(new Date).getTime()-_debugStartTime;typeof console!="undefined"&&console.log("mb.dbg ("+parseFloat(t/1e3).toFixed(3)+"): "+e)}}function _setCookie(e,t,n){var r=new Date;r.setTime(r.getTime()+n*1e3);var i="expires="+r.toUTCString();return(document.cookie=e+"="+t+"; "+i+"; path=/")?!0:!1}function _getCookie(e){var t=e+"=",n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r];while(i.charAt(0)==" ")i=i.substring(1);if(i.indexOf(t)==0)return i.substring(t.length,i.length)}return null}function _removeCookie(e,t,n){document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(n?"; domain="+n:"")+(t?"; path="+t:"")}function _getRequestData(e){var t={orig_request:window.location.href.substr(window.location.protocol.length+2+window.location.host.length),full_action_name:_contextAction,message_sessions:_contextMessageSessions,blocks:"",_contextCounter:0},n=_getBlocks(e);return t.blocks=Object.toJSON(n),t._contextCounter=n._contextCounter,typeof _contextProductId!="undefined"&&_contextProductId&&(t.currentProductId=_contextProductId),typeof _contextCmsId!="undefined"&&_contextCmsId&&(t.currentCmsId=_contextCmsId),typeof _contextCategoryId!="undefined"&&_contextCategoryId&&(t.currentCategoryId=_contextCategoryId),document.referrer!=="undefined"&&document.referrer&&(t.refferer=document.referrer),t}function _getBlocks(e,t){_contextDebugLog('getting blocks of type "'+e+'"...');var n={},r=0;return t==undefined&&(t="c_"),$$("."+e).each(function(i){var s=i.readAttribute("id");s||(s=t+r,i.setAttribute("id",s));var o=i.readAttribute("rel");if(o){n[s]=o;var u=null;if(_contextInlineLocalCache==1)if(_browserSupportsLocalStorage())var u=_getCachedBlock(s);else{if(_browserSupportsSessionStorage())var u=_getCachedBlockFromSession(s);if(u==null)var u=_getCachedBlockFromCookie(s)}u!=null&&(_contextDebugLog('... got cached data, updating block "'+s+'" ('+e+") from cache..."),$(s).update(u.Content)),r++}}),n._contextCounter=r,n}function _updateFormKeys(e){var t=0;_contextDebugLog("_updateFormKeys: updating formkeys...");if(e==undefined||e.empty()){_contextDebugLog("_updateFormKeys: ... formkeys could not be updated: no formkey value supplied for _updateFormKeys!");return}$$('[name="formkey"]').each(function(n){var r=n.value;e!=r&&(_contextDebugLog("_updateFormKeys: updating element with name=formkey..."),n.setValue(e),t++)}),$$('[name="form_key"]').each(function(n){var r=n.value;e!=r&&(_contextDebugLog("_updateFormKeys: updating element with name=form_key..."),n.setValue(e),t++)}),$$("form").each(function(n){if(typeof n.action!="undefined"&&n.action!=""){var r=n.action,i=n.action;i=n.action.replace(/(form_?key)\/(\w*)/g,"$1/"+e),i!=r&&(_contextDebugLog("_updateFormKeys: updating form action containing formkey or form_key..."),n.action=i,t++)}}),$$("a").each(function(n){if(typeof n.href!="undefined"&&n.href!=""){var r=n.href,i=n.href.replace(/(form_?key)\/(\w*)/g,"$1/"+e);i!=r&&(_contextDebugLog("_updateFormKeys: updating anchors with hrefs containing formkey or form_key..."),n.href=i,t++)}}),$$("button").each(function(n){var r=n.outerHTML,i=n.outerHTML.replace(/(form_?key)\/(\w*)/g,"$1/"+e);i!=r&&(_contextDebugLog("_updateFormKeys: updating buttons with hrefs containing formkey or form_key..."),n.outerHTML=i,t++)}),$$("input[type=hidden]").each(function(n){if(typeof n.value!="undefined"&&n.value!=""){var r=n.value;new_value=n.value.replace(/(form_?key)\/(\w*)/g,"$1/"+e),new_value!=r&&(_contextDebugLog("_updateFormKeys: updating form with hidden input value containing formkey or form_key..."),n.value=new_value,t++)}}),t>0?_contextDebugLog("... "+t+" formkey values updated."):_contextDebugLog("... no formkey values needed updating; current session matches.")}function _doContextBlocks(){var e=_getRequestData("ctdblock");typeof window.hxs.context=="undefined"&&(window.hxs.context=new Array);if(typeof e.currentProductId!="undefined"||e._contextCounter>0){var t=_getBlocks("ctpriceblock"),n=_getBlocks("cttierpriceblock","tp_"),r=_getBlocks("ctstockblock","s_");if(!!window.hxs.context[e])return;window.hxs.context[e]=!0,t._contextCounter>0&&(e.prices=Object.toJSON(t)),n._contextCounter>0&&(e.tierprices=Object.toJSON(n)),r._contextCounter>0&&(e.stock=Object.toJSON(r));var i=0;new Ajax.Request(_contextRequestUrl,{method:_contextAsyncMethod,parameters:e,evalJS:"force",onSuccess:function(e){var t=e.responseText.evalJSON();for(var n in t.blocks)$(n).update(t.blocks[n]),_contextDebugLog('trying to update and cache block "'+n+'"...'),_browserSupportsLocalStorage()&&_cacheBlock(n,t.blocks[n])?(_contextDebugLog('... block "'+n+'" successfully cached ('+t.blocks[n].length+" bytes) to localStorage."),i++):_browserSupportsSessionStorage()&&_cacheBlockForSession(n,t.blocks[n])?(_contextDebugLog('... block "'+n+'" successfully cached ('+t.blocks[n].length+" bytes) to sessionStorage."),i++):_browserSupportsCookieStorage()&&_cacheBlockForCookie(n,t.blocks[n])?(_contextDebugLog('... block "'+n+'" successfully cached ('+t.blocks[n].length+" bytes) to cookie."),i++):_contextDebugLog('... block "'+n+'" could not be cached, no available methods of storage found.');for(var n in t.prices)_contextDebugLog('trying to update and cache price "'+n+'"...'),$(n).update(t.prices[n]),_browserSupportsSessionStorage()&&_cacheBlockForSession(n,t.prices[n])?(_contextDebugLog('... price "'+n+'" successfully cached ('+t.prices[n].length+" bytes) to sessionStorage."),i++):_browserSupportsCookieStorage()&&_cacheBlockForCookie(n,t.prices[n])?(_contextDebugLog('... price "'+n+'" successfully cached ('+t.prices[n].length+" bytes) to cookie."),i++):_contextDebugLog('... price "'+n+'" could not be cached, no available methods of storage found.');for(var n in t.tierprices)_contextDebugLog('trying to update and cache tierprice "'+n+'"...'),$(n).update(t.tierprices[n]),_browserSupportsSessionStorage()&&_cacheBlockForSession(n,t.tierprices[n])?(_contextDebugLog('... tierprice "'+n+'" successfully cached ('+t.tierprices[n].length+" bytes) to sessionStorage."),i++):_browserSupportsCookieStorage()&&_cacheBlockForCookie(n,t.tierprices[n])?(_contextDebugLog('... tierprice "'+n+'" successfully cached ('+t.tierprices[n].length+" bytes) to cookie."),i++):_contextDebugLog('... tierprice "'+n+'" could not be cached, no available methods of storage found.');for(var n in t.stock)_contextDebugLog('trying to update and cache stock "'+n+'"...'),$(n).update(t.stock[n]),_browserSupportsSessionStorage()&&_cacheBlockForSession(n,t.stock[n])?(_contextDebugLog('... stock "'+n+'" successfully cached ('+t.stock[n].length+" bytes) to sessionStorage."),i++):_browserSupportsCookieStorage()&&_cacheBlockForCookie(n,t.stock[n])?(_contextDebugLog('... stock "'+n+'" successfully cached ('+t.stock[n].length+" bytes) to cookie."),i++):_contextDebugLog('... stock "'+n+'" could not be cached, no available methods of storage found.');t.formkey!=undefined&&(_updateFormKeys(t.formkey),_cacheFormkey(t.formkey)),typeof _mageBoostPostSessionContextAjax=="function"&&_mageBoostPostSessionContextAjax()},onFailure:function(e){typeof _mageBoostFirstloadOverlay!="undefined"&&e.status!=200&&($("mageboost-overlay").hide(),_contextDebugLog("sometime went wrong! AJAX update returned HTTP status "+e.status),clearInterval(_mageBoostFirstloadOverlay))},onComplete:function(e){window.hxs.context[e]=!1,_contextDebugLog(i+" placeholders updated.")}})}}function _doLazyDataBlocks(e){var t=_getRequestData("ctddatablock");typeof window.hxs.lazy=="undefined"&&(window.hxs.lazy=new Array);if((typeof t.currentProductId!="undefined"||typeof t.currentCategoryId!="undefined"||typeof t.currentCmsId!="undefined")&&t._contextCounter>0){if(!!window.hxs.lazy[e])return;window.hxs.lazy[e]=!0,new Ajax.Request(e,{method:_contextAsyncMethod,parameters:t,evalJS:"force",onSuccess:function(e){var t=e.responseText.evalJSON();for(var n in t.blocks)_contextDebugLog('updating block "'+n+'"...'),$(n).update(t.blocks[n])?_contextDebugLog('... datablock "'+n+'" updated with '+t.blocks[n].length+" bytes of data."):_contextDebugLog('... could NOT update datablock "'+n+'" with '+t.blocks[n].length+" bytes of data!");t.formkey!=undefined&&(_updateFormKeys(t.formkey),_cacheFormkey(t.formkey))},onFailure:function(e){typeof _mageBoostFirstloadOverlay!="undefined"&&e.status!=200&&($("mageboost-overlay").hide(),_contextDebugLog("sometime went wrong! AJAX update returned HTTP status "+e.status),clearInterval(_mageBoostFirstloadOverlay))},onComplete:function(e){window.hxs.lazy[e]=!1}})}}function _loadSessionContext(){typeof _mageBoostPreSessionContext=="function"&&_mageBoostPreSessionContext(),_contextDebugLog("loading session context..."),typeof window.hxs=="undefined"&&(window.hxs=new Object),_doContextBlocks(),typeof _contextProductId!="undefined"&&_contextProductId&&_doLazyDataBlocks(_contextProductLazyRequestUrl),typeof _contextCategoryId!="undefined"&&_contextCategoryId&&_doLazyDataBlocks(_contextCategoryLazyRequestUrl),typeof _contextCmsId!="undefined"&&_contextCmsId&&_doLazyDataBlocks(_contextCmsLazyRequestUrl),typeof _mageBoostPostSessionContext=="function"&&_mageBoostPostSessionContext()}function _cacheFormkey(e){var t=null;_browserSupportsSessionStorage()&&sessionStorage.setItem("mblc_formkey",e);if(_setCookie("mblc_formkey",e,_sessionlifetime))return e}function _getCachedFormkey(){if(_formkeyFromCache!=null)return _formkeyFromCache;var e=null;return _browserSupportsSessionStorage()&&(e=sessionStorage.getItem("mblc_formkey")),e==null?(e=_getCookie("mblc_formkey"),e==null?_contextDebugLog("no cookie formkey found..."):_contextDebugLog("cookie formkey found: "+e)):e==null?_contextDebugLog("no sessionStorage formkey found..."):_contextDebugLog("sessionStorage formkey found: "+e),_formkeyFromCache=e,e}function _cacheBlock(e,t){if(_browserSupportsLocalStorage()){var n={Id:e,Content:t,Timestamp:(new Date).getTime()};return localStorage.setItem("mblc_"+e,JSON.stringify(n)),!0}return!1}function _cacheBlockForSession(e,t){if(_browserSupportsSessionStorage()){var n={Id:e,Content:t,Timestamp:(new Date).getTime()};return sessionStorage.setItem("mblc_"+e,JSON.stringify(n)),!0}return!1}function _cacheBlockForCookie(e,t){var n={Id:e,Content:t,Timestamp:(new Date).getTime()};return _setCookie("mblc_"+e,JSON.stringify(n),_sessionlifetime)?!0:!1}function _getCachedBlockFromCookie(e){_contextDebugLog('getting cookie data for block "mblc_'+e+'"');var t=_getCookie("mblc_"+e);return t==null?null:JSON.parse(t)}function _getCachedBlockFromSession(e){_contextDebugLog('getting sessionStorage data for block "mblc_'+e+'"');var t=sessionStorage.getItem("mblc_"+e);return t==null?null:JSON.parse(t)}function _getCachedBlock(e){if(_checkCacheBlockValid(e)){_contextDebugLog('getting localStorage data for block "mblc_'+e+'"');var t=localStorage.getItem("mblc_"+e);return t==null?null:JSON.parse(t)}return null}function _checkCacheBlockValid(e){if(_browserSupportsLocalStorage()){var t=localStorage.getItem("mblc_"+e);return t==null?!1:(createdTimestamp=JSON.parse(t).Timestamp,(new Date).getTime()-createdTimestamp<=_sessionTimeout)}return!1}_debugStartTime=(new Date).getTime(),_browserSupportsLocalStorageSet=null,_browserSupportsSessionStorageSet=null,_browserSupportsCookieStorageSet=null,_formkeyFromCache=null;var _HashSearch=new function(){var e;this.set=function(t,n){e[t]=n,this.push()},this.remove=function(t,n){delete e[t],this.push()},this.get=function(t,n){return e[t]},this.keyExists=function(t){return e.hasOwnProperty(t)},this.push=function(){var t=[],n,r;for(n in e)e.hasOwnProperty(n)&&(n=escape(n),r=escape(e[n]),t.push(n+(r!=="undefined"?"="+r:"")));window.location.hash=t.join("&")},(this.load=function(){e={};var t=window.location.hash,n,r;t=t.substring(1,t.length),n=t.split("&");for(var i=0;i<n.length;i++)r=n[i].split("="),e[unescape(r[0])]=typeof r[1]!="undefined"?unescape(r[1]):r[1]})()},_sessionTimeout=864e5,_browserVer=_getIeVer();_browserVer>-1&&_browserVer<9?Event.observe(window,"load",function(){typeof _contextAction!="undefined"&&_loadSessionContext()}):document.observe("dom:loaded",function(){typeof _contextAction!="undefined"&&_loadSessionContext()});